---
import BaseLayout from '../layouts/BaseLayout.astro';
import Pwd from '../components/Pwd.astro';
import Tree from '../components/Tree.astro';
import Cat from '../components/Cat.astro';
import Prompt from '../components/Prompt.astro';
import { getCollection } from 'astro:content';
import { extractUniqueDates } from '../lib/entry-utils';

export async function getStaticPaths() {
  const allEntries = await getCollection('daily');
  const dates = extractUniqueDates(allEntries);
  
  return dates.map((date) => ({
    params: { date }
  }));
}

const { date } = Astro.params;

const pageTitle = `${date} - Daily LLM Conversations`;
---

<BaseLayout title={pageTitle}>
  <div class="main-content">
    <div class="section-gap">
      <Pwd path={`/${date}`} />
    </div>

    <div class="tree-session section-gap">
      <div class="command-block">
        <Prompt command="tree" />
      </div>
      
      <div class="file-listing">
        <Tree path={`/${date}`} />
      </div>
    </div>

    <Cat path={`/${date}/`} />

    <!-- Navigation Commands -->
    <div class="command-block">
      <Prompt command="cd ../" clickable={true} href="/" />
    </div>
  </div>
</BaseLayout>

<style>
  .file-listing {
    margin-left: 0;
  }

  .empty {
    margin-top: var(--space-lg);
  }
</style>