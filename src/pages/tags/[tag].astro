---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Pwd from '../../components/Pwd.astro';
import Prompt from '../../components/Prompt.astro';
import Tree from '../../components/Tree.astro';
import { getCollection } from 'astro:content';
import { isConversationEntry } from '../../lib/entry-utils';

export async function getStaticPaths() {
  const allEntries = await getCollection('daily');
  
  // Extract all unique tags from conversation entries
  const allTags = new Set<string>();
  allEntries
    .filter(isConversationEntry)
    .forEach(entry => {
      if (entry.data.tags && Array.isArray(entry.data.tags)) {
        entry.data.tags.forEach(tag => allTags.add(tag));
      }
    });
  
  return Array.from(allTags).map(tag => ({
    params: { tag }
  }));
}

const { tag } = Astro.params;

const pageTitle = `Tag: ${tag} - Daily LLM Conversations`;
---

<BaseLayout title={pageTitle}>
  <div class="main-content">
    <div class="section-gap">
      <Pwd path={`/tags/${tag}`} />
    </div>

    <div class="terminal-session">
      <div class="command-block">
        <Prompt command="tree" />
      </div>
      
      <div class="tree-output">
        <Tree path={`/tags/${tag}`} />
      </div>
    </div>

    <!-- Navigation Commands -->
    <div class="command-block">
      <Prompt command="cd ../" clickable={true} href="/tags/" />
      <Prompt command="cd ../../" clickable={true} href="/" />
    </div>
  </div>
</BaseLayout>