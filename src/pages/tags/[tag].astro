---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Pwd from '../../components/Pwd.astro';
import Prompt from '../../components/Prompt.astro';
import TagTree from '../../components/TagTree.astro';

export async function getStaticPaths() {
  // Get all content files
  const allContent = await Astro.glob('../../../content/**/*.md');
  
  // Extract all unique tags from frontmatter
  const allTags = new Set();
  allContent
    .filter(file => !file.file.endsWith('index.md')) // Only conversations have tags
    .forEach(file => {
      if (file.frontmatter.tags && Array.isArray(file.frontmatter.tags)) {
        file.frontmatter.tags.forEach(tag => allTags.add(tag));
      }
    });
  
  return Array.from(allTags).map(tag => ({
    params: { tag }
  }));
}

const { tag } = Astro.params;

// Get all content files
const allContent = await Astro.glob('../../../content/**/*.md');

// No additional processing needed - Tree component handles everything

const pageTitle = `Tag: ${tag} - Daily LLM Conversations`;
---

<BaseLayout title={pageTitle}>
  <div class="main-content">
    <div class="section-gap">
      <Pwd 
        currentPage="tag"
        tagName={tag}
        allContent={allContent}
      />
    </div>

    <div class="terminal-session">
      <div class="command-block">
        <Prompt command="tree" />
      </div>
      
      <div class="tree-output">
        <TagTree mode="tag" tag={tag} />
      </div>
    </div>

    <!-- Navigation Commands -->
    <div class="command-block">
      <Prompt command="cd ../" clickable={true} href="/tags/" />
      <Prompt command="cd ../../" clickable={true} href="/" />
    </div>
  </div>
</BaseLayout>

